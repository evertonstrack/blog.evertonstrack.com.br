
<!-- Google Analytics -->
{%- if jekyll.environment == 'production' and site.google_analytics -%}
  {%- include google-analytics.html -%}
{%- endif -%}
<!-- /Google Analytics -->

<div class="toast">
  <p class="toast__text">Nova atualização disponível! Atualize o webapp para ver as novas mudanças.</p>
  <button class="toast__button">Atualizar</button>
</div>

<script>
  const themeToggle = document.querySelector("input[name=theme]");
  const isPreferredThemeDark = window.matchMedia('(prefers-color-scheme: dark)');

  if( window.__theme === 'dark' ) {
    themeToggle.checked = true;
  }

  isPreferredThemeDark.addListener(event => {
    console.log('THEME CHANGES -> event', event);
    console.log('THEME CHANGES -> event.matches', event.matches);

    setPreferredTheme(event.matches ? 'dark' : 'light');
    themeToggle.checked = event.matches ? true : false;
  });

  themeToggle.addEventListener("change", ({ target }) => {
    const theme = target.checked ? 'dark' : 'light';
    setPreferredTheme(theme);
  });

  setTimeout(function() { themeToggle.classList.add('animating') }, 250);
</script>

<!-- Verify new version -->
<script>
  // listen to the service worker promise in index.html to see if there has been a new update.
  // condition: the service-worker.js needs to have some kind of change - e.g. increment CACHE_VERSION.
  window['isUpdateAvailable']
    .then(function(isAvailable) {
      if (isAvailable) {
        document.querySelector('.toast').classList.add('show');
      }
    });

  document.querySelector('.toast__button').addEventListener('click', function(){
    window.location.reload();
  });
</script>


